---
phase: 02-tdd-workflow
plan: 02
type: execute
wave: 2
depends_on: ["01"]
files_modified:
  - get-shit-done/workflows/execute-plan.md
  - get-shit-done/workflows/execute-phase.md
  - agents/gsd-executor.md
autonomous: true

must_haves:
  truths:
    - Executor detects type: tdd from plan frontmatter before execution
    - Executor runs RED-GREEN-REFACTOR cycle for TDD plans
    - TDD plans produce 2-3 commits (test, feat, refactor)
  artifacts:
    - path: get-shit-done/workflows/execute-plan.md
      provides: tdd_plan_execution section, type check
    - path: get-shit-done/workflows/execute-phase.md
      provides: tdd.md in executor execution_context
  key_links:
    - from: execute-phase spawn prompt
      to: tdd.md reference
      via: execution_context
      pattern: tdd\.md
---

<objective>
Ensure executor correctly runs Red-Green-Refactor cycle for TDD plans and produces 2-3 commits.

Purpose: TDD-03 — Executor runs Red-Green-Refactor cycle for TDD plans.
Output: Verified executor flow, tdd.md reference in spawn, commit pattern enforced.
</objective>

<execution_context>
@get-shit-done/workflows/execute-plan.md
@get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-tdd-workflow/02-RESEARCH.md
@get-shit-done/references/tdd.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Verify execute-phase passes tdd.md to executor</name>
  <files>get-shit-done/workflows/execute-phase.md</files>
  <action>
In get-shit-done/workflows/execute-phase.md, locate the executor spawn prompt (execute_waves step, "Each agent gets prompt" / execution_context).

Verify execution_context includes:
@~/.claude/get-shit-done/references/tdd.md

If missing, add it. The executor needs tdd.md for TDD plan execution. Current reference shows it at line 370—confirm it is in the execution_context block passed to spawned agents.
  </action>
  <verify>grep "tdd.md" get-shit-done/workflows/execute-phase.md</verify>
  <done>execute-phase execution_context includes tdd.md reference for executor</done>
</task>

<task type="auto">
  <name>Task 2: Harden execute-plan type:tdd detection and flow</name>
  <files>get-shit-done/workflows/execute-plan.md</files>
  <action>
In get-shit-done/workflows/execute-plan.md:

1. In the execute step (or parse_segments), add explicit instruction: Before executing any plan, read frontmatter and check `type: tdd`. If present, follow `<tdd_plan_execution>` section exclusively—do not use standard task loop for TDD plans.

2. Ensure `<tdd_plan_execution>` section is complete:
   - RED: Write failing test, run test (must fail), commit test(phase-plan)
   - GREEN: Implement to pass, run test (must pass), commit feat(phase-plan)
   - REFACTOR: Clean up if needed, run test (must pass), commit refactor(phase-plan) only if changes

3. Add to success_criteria or verification: For type:tdd plans, exactly 2-3 commits (test, feat, optionally refactor). Document this in the tdd_plan_execution section.

4. Ensure the load_prompt step or first execution step directs executor to check plan type before choosing execution path.
  </action>
  <verify>grep -E "type: tdd|type:tdd|tdd_plan_execution" get-shit-done/workflows/execute-plan.md</verify>
  <done>execute-plan explicitly routes type:tdd plans to RED-GREEN-REFACTOR, documents 2-3 commit requirement</done>
</task>

<task type="auto">
  <name>Task 3: Align gsd-executor agent with execute-plan TDD flow</name>
  <files>agents/gsd-executor.md</files>
  <action>
In agents/gsd-executor.md, ensure TDD execution guidance matches execute-plan.md:

1. Executor must check plan frontmatter for `type: tdd` at start of execution (before task loop).

2. If type: tdd: Follow RED-GREEN-REFACTOR from tdd.md and execute-plan's tdd_plan_execution. Do NOT iterate over tasks as standard auto tasks—TDD has its own cycle.

3. Commit pattern: test(...), feat(...), refactor(...) — exactly 2-3 commits per TDD plan.

4. Remove or fix any reference to task-level `tdd="true"` attribute if it conflicts with plan-level `type: tdd`. The canonical signal is frontmatter `type: tdd`, not per-task attribute.
  </action>
  <verify>grep -E "type: tdd|type:tdd|frontmatter" agents/gsd-executor.md</verify>
  <done>gsd-executor checks plan type:tdd and follows TDD cycle; no conflicting task-level tdd attribute</done>
</task>

</tasks>

<verification>
- Executor receives tdd.md
- type:tdd plans route to RED-GREEN-REFACTOR
- 2-3 commits (test, feat, refactor) documented and enforced
</verification>

<success_criteria>
- TDD-03 satisfied: Executor runs Red-Green-Refactor cycle for TDD plans
- TDD plans produce 2-3 commits per success criteria
- No conflicting signals (plan-level type:tdd is canonical)
</success_criteria>

<output>
After completion, create .planning/phases/02-tdd-workflow/02-02-SUMMARY.md
</output>
