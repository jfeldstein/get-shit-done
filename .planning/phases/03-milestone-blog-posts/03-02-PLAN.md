---
phase: 03-milestone-blog-posts
plan: 02
type: execute
wave: 2
depends_on: ["03-01"]
files_modified:
  - scripts/generate-blog-posts.js
autonomous: true

must_haves:
  truths:
    - "Script collects all milestone artifacts (summaries, context, verification, UAT, diffs, requirements, session logs)"
    - "Script synthesizes architecture post content from artifacts"
    - "Script synthesizes agentic practices post content from artifacts"
    - "Posts include code snippets with importance annotations"
    - "Posts use adaptive length based on milestone complexity"
  artifacts:
    - path: "scripts/generate-blog-posts.js"
      provides: "Complete artifact collection and content synthesis"
      contains: "collectArtifacts, synthesizeArchitecturePost, synthesizeAgenticPost implementations"
  key_links:
    - from: "scripts/generate-blog-posts.js"
      to: ".planning/phases/*/SUMMARY.md"
      via: "fs.readFileSync reading phase summaries"
      pattern: "readFileSync.*SUMMARY\\.md"
    - from: "scripts/generate-blog-posts.js"
      to: ".planning/phases/*/CONTEXT.md"
      via: "fs.readFileSync reading phase context"
      pattern: "readFileSync.*CONTEXT\\.md"
    - from: "scripts/generate-blog-posts.js"
      to: ".planning/phases/*/VERIFICATION.md"
      via: "fs.readFileSync reading verification reports"
      pattern: "readFileSync.*VERIFICATION\\.md"
    - from: "scripts/generate-blog-posts.js"
      to: "git diff"
      via: "child_process.execSync git commands"
      pattern: "execSync.*git diff"
    - from: "scripts/generate-blog-posts.js"
      to: "docs/blog/"
      via: "fs.writeFileSync writing synthesized posts"
      pattern: "writeFileSync.*docs/blog"
---

<objective>
Implement artifact collection and content synthesis for blog post generation.

Purpose: Collect all milestone artifacts (summaries, context, verification, UAT, diffs, requirements, session logs) and synthesize them into two blog posts (architecture/project learnings and agentic coding practices).

Output: Complete implementation of collectArtifacts, synthesizeArchitecturePost, and synthesizeAgenticPost functions in generate-blog-posts.js.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/03-milestone-blog-posts/03-CONTEXT.md
@.planning/phases/03-milestone-blog-posts/03-RESEARCH.md
@.planning/phases/03-milestone-blog-posts/03-01-SUMMARY.md
@get-shit-done/workflows/complete-milestone.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Implement artifact collection</name>
  <files>
    scripts/generate-blog-posts.js
  </files>
  <action>
Implement `collectArtifacts(milestoneVersion)` function that gathers all milestone artifacts:

**Phase artifacts (from .planning/phases/):**
- Find all phase directories matching milestone (by phase number range or milestone tag)
- Read all `*-SUMMARY.md` files (what was built, how)
- Read all `*-CONTEXT.md` files (decisions made, trade-offs) - handle missing gracefully
- Read all `*-VERIFICATION.md` files (gaps found, what broke) - handle missing gracefully
- Read all `*-UAT.md` files (user testing results) - handle missing gracefully
- Use `fs.readdirSync` and `fs.readFileSync` with error handling (missing files = empty string)

**Git diffs:**
- Find git commit range for milestone (use `git log --oneline --grep="feat("` pattern from complete-milestone.md)
- Extract first and last commit in milestone range
- Run `git diff --stat ${FIRST_COMMIT}..${LAST_COMMIT}` for overview
- Run `git diff ${FIRST_COMMIT}..${LAST_COMMIT}` for full diff (limit to reasonable size, e.g., first 5000 lines)
- Use `child_process.execSync` with error handling
- Include commit messages: `git log --oneline ${FIRST_COMMIT}..${LAST_COMMIT}`

**Requirements:**
- Read `.planning/REQUIREMENTS.md` (original intent vs outcome) - handle missing gracefully

**Session logs:**
- Check multiple locations: `~/.claude/logs/`, `~/Library/Application Support/Cursor/logs/`, project root `logs/`
- Find logs matching milestone timeframe (by date or session ID correlation)
- Read log files if found (JSON or text format)
- If logs not found, log warning but continue (graceful degradation)

**Subagent data:**
- Read `.planning/agent-history.json` if exists (subagent prompts/outputs, iteration counts, timing)
- Extract: agent IDs, timestamps, task descriptions, iteration counts, failures/recoveries
- If missing, use phase SUMMARY.md files as fallback for subagent work descriptions

**Return structure:**
```javascript
{
  phases: {
    summaries: [...],
    contexts: [...],
    verifications: [...],
    uats: [...]
  },
  git: {
    diffStat: "...",
    diff: "...",
    commits: [...]
  },
  requirements: "...",
  sessionLogs: [...],
  subagentData: {...}
}
```

Handle all errors gracefully - missing artifacts should not fail collection, just return empty/partial data.
  </action>
  <verify>
Function collects artifacts without errors:
```bash
node -e "const mod = require('./scripts/generate-blog-posts.js'); const artifacts = mod.collectArtifacts('1.0'); console.log(artifacts.phases ? '✓ Artifacts collected' : '✗ Collection failed')"
```
Function handles missing files gracefully (no crashes on missing CONTEXT.md, VERIFICATION.md, etc.).
  </verify>
  <done>
collectArtifacts function reads all milestone artifacts (summaries, context, verification, UAT, git diffs, requirements, session logs, subagent data) and returns structured object. Missing artifacts handled gracefully.
  </done>
</task>

<task type="auto">
  <name>Task 2: Implement content synthesis for architecture posts</name>
  <files>
    scripts/generate-blog-posts.js
  </files>
  <action>
Implement `synthesizeArchitecturePost(artifacts, template)` function that:

**Extract content from artifacts:**
- Title: Derive from milestone name (e.g., "Worktree Integration: Building Isolated Agent Execution")
- Date: Current date (ISO format)
- Milestone version: From function parameter
- Introduction: Synthesize from REQUIREMENTS.md (original intent) and phase summaries (what was accomplished)
- Key learnings: Extract from CONTEXT.md (decisions, trade-offs), VERIFICATION.md (gaps, what broke), UAT.md (user feedback)
- Code snippets: Extract from git diffs (important files mentioned in SUMMARY.md, changes in VERIFICATION.md gaps)
- Conclusion: Synthesize from phase summaries (outcomes, next steps)

**Content synthesis logic:**
- Parse markdown artifacts (simple string operations, no complex parsing needed)
- Extract key sections: decisions from CONTEXT.md, gaps from VERIFICATION.md, outcomes from SUMMARY.md
- Identify important code files: files mentioned in SUMMARY.md "Files Modified", files with gaps in VERIFICATION.md
- Extract code snippets from git diff for important files (limit snippet size, include context)
- Annotate code snippets: mark as "important" if mentioned in SUMMARY or VERIFICATION, "supporting" otherwise

**Template replacement:**
- Replace placeholders in template: {{TITLE}}, {{DATE}}, {{MILESTONE_VERSION}}, {{INTRO}}, {{LEARNINGS}}, {{CODE_SNIPPETS}}, {{CONCLUSION}}
- Format learnings as markdown sections with headers
- Format code snippets as markdown code blocks with language tags and annotations
- Adaptive length: if milestone has few learnings, shorter post; if many learnings, longer post

**Voice and structure:**
- Technical depth: explain architectural decisions, trade-offs, implementation details
- Clear narrative: what was built, why, what was learned
- Lessons learned: extract insights from CONTEXT.md decisions and VERIFICATION.md gaps

Return synthesized markdown string ready for writing.
  </action>
  <verify>
Function synthesizes content:
```bash
node -e "const mod = require('./scripts/generate-blog-posts.js'); const fs = require('fs'); const template = fs.readFileSync('get-shit-done/templates/blog-post-architecture.md', 'utf8'); const artifacts = { phases: { summaries: ['Test summary'] }, git: { diff: 'test diff' } }; const post = mod.synthesizeArchitecturePost(artifacts, template); console.log(post.includes('{{') ? '✗ Placeholders remain' : '✓ Content synthesized')"
```
Synthesized content has no remaining placeholders and includes markdown formatting.
  </verify>
  <done>
synthesizeArchitecturePost function extracts content from artifacts, synthesizes narrative, includes code snippets with importance annotations, and replaces all template placeholders with synthesized content.
  </done>
</task>

<task type="auto">
  <name>Task 3: Implement content synthesis for agentic practices posts</name>
  <files>
    scripts/generate-blog-posts.js
  </files>
  <action>
Implement `synthesizeAgenticPost(artifacts, template)` function that:

**Extract content from artifacts:**
- Title: "Agentic Coding Practices: Learnings from {Milestone Name}"
- Date: Current date (ISO format)
- Milestone version: From function parameter
- Introduction: Synthesize from subagent data and phase summaries (agentic workflow overview)
- Iteration patterns: Extract from agent-history.json (planner-checker loops, revision attempts, iteration counts)
- Failures and recoveries: Extract from VERIFICATION.md gaps, phase summaries "Issues Encountered", subagent failure data
- Timing data: Extract from phase summaries (how long phases/plans took), subagent timing data
- Worktree patterns: Extract from phase summaries (branch flows, merge strategies) - if Phase 1 worktree integration exists
- Prompt/template evolution: Extract from phase CONTEXT.md (how instructions were refined), template changes in git diff

**Content synthesis logic:**
- Parse subagent data: extract iteration counts, failure patterns, timing metrics
- Identify patterns: planner-checker loops, revision cycles, worktree orchestration
- Extract failure stories: what broke, how it was recovered, lessons learned
- Calculate timing insights: average phase duration, plan execution time, iteration overhead
- Document worktree patterns: branch naming, merge strategies, isolation benefits (if Phase 1 completed)
- Track prompt evolution: how agent instructions improved, template refinements

**Template replacement:**
- Replace placeholders: {{TITLE}}, {{DATE}}, {{MILESTONE_VERSION}}, {{INTRO}}, {{ITERATION_PATTERNS}}, {{FAILURES}}, {{TIMING}}, {{WORKTREE_PATTERNS}}, {{CONCLUSION}}
- Format patterns as markdown sections with examples
- Format failures as stories with recovery steps
- Format timing as metrics/insights
- Format worktree patterns as process descriptions (if available)

**Voice and structure:**
- Process-focused: meta-learning about agentic workflows
- Practical insights: what worked, what didn't, how to improve
- Iteration analysis: how many loops, why, what changed

**Graceful degradation:**
- If subagent data missing: use phase summaries as fallback
- If timing data missing: note "timing data not available"
- If worktree patterns missing (Phase 1 not done): omit worktree section or note "worktree integration not yet implemented"

Return synthesized markdown string ready for writing.
  </action>
  <verify>
Function synthesizes agentic content:
```bash
node -e "const mod = require('./scripts/generate-blog-posts.js'); const fs = require('fs'); const template = fs.readFileSync('get-shit-done/templates/blog-post-agentic.md', 'utf8'); const artifacts = { phases: { summaries: ['Test summary'] }, subagentData: {} }; const post = mod.synthesizeAgenticPost(artifacts, template); console.log(post.includes('{{') ? '✗ Placeholders remain' : '✓ Content synthesized')"
```
Synthesized content has no remaining placeholders and includes agentic workflow insights.
  </verify>
  <done>
synthesizeAgenticPost function extracts agentic patterns from artifacts, synthesizes iteration/failure/timing insights, includes worktree patterns if available, and replaces all template placeholders with synthesized content.
  </done>
</task>

</tasks>

<verification>
- collectArtifacts reads all milestone artifacts without errors
- synthesizeArchitecturePost produces markdown with no placeholders
- synthesizeAgenticPost produces markdown with no placeholders
- Code snippets include importance annotations
- Content length adapts to milestone complexity
- Missing artifacts handled gracefully
</verification>

<success_criteria>
- All artifact sources collected (summaries, context, verification, UAT, diffs, requirements, session logs, subagent data)
- Architecture post synthesizes technical learnings with code examples
- Agentic post synthesizes workflow patterns and insights
- Both posts ready for writing to docs/blog/
</success_criteria>

<output>
After completion, create `.planning/phases/03-milestone-blog-posts/03-02-SUMMARY.md`
</output>
