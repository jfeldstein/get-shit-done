---
phase: 03-milestone-blog-posts
plan: 03
type: execute
wave: 3
depends_on: ["03-02"]
files_modified:
  - get-shit-done/workflows/complete-milestone.md
  - .planning/config.json
autonomous: true

must_haves:
  truths:
    - "/gsd:complete-milestone triggers blog post generation automatically"
    - "Blog generation step runs after git_tag, before git_commit_milestone"
    - "Blog generation failures retry, then warn without blocking milestone completion"
    - "Blog generation can be disabled via config.json"
  artifacts:
    - path: "get-shit-done/workflows/complete-milestone.md"
      provides: "Updated workflow with blog generation step"
      contains: "generate_blog_posts step after git_tag"
    - path: ".planning/config.json"
      provides: "Blog generation configuration flag"
      contains: "blog_generation"
  key_links:
    - from: "get-shit-done/workflows/complete-milestone.md"
      to: "scripts/generate-blog-posts.js"
      via: "Workflow step calls generateBlogPosts function"
      pattern: "generate-blog-posts\\.js|generateBlogPosts"
    - from: "get-shit-done/workflows/complete-milestone.md"
      to: ".planning/config.json"
      via: "Config check for blog_generation flag"
      pattern: "blog_generation"
---

<objective>
Integrate blog generation into complete-milestone workflow with configurable enable/disable and non-blocking error handling.

Purpose: Make blog post generation automatic when milestones complete, while allowing users to disable it and ensuring failures don't block milestone completion.

Output: Updated complete-milestone.md workflow with blog generation step, config.json with blog_generation flag, and proper error handling.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/03-milestone-blog-posts/03-CONTEXT.md
@.planning/phases/03-milestone-blog-posts/03-RESEARCH.md
@.planning/phases/03-milestone-blog-posts/03-01-SUMMARY.md
@.planning/phases/03-milestone-blog-posts/03-02-SUMMARY.md
@get-shit-done/workflows/complete-milestone.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add blog generation step to complete-milestone workflow</name>
  <files>
    get-shit-done/workflows/complete-milestone.md
  </files>
  <action>
Add blog generation step to `complete-milestone.md` workflow after `git_tag` step and before `git_commit_milestone` step.

**Step structure:**
```markdown
<step name="generate_blog_posts">

Generate two blog posts for this milestone.

**Check if blog generation enabled:**
```bash
BLOG_GENERATION=$(cat .planning/config.json 2>/dev/null | grep -o '"blog_generation"[[:space:]]*:[[:space:]]*[^,}]*' | grep -o 'true\|false' || echo "true")
```

**If disabled:** Skip silently (log: "Blog generation disabled, skipping")

**If enabled:**
1. Extract milestone version and name (from user input or git tag)
2. Call blog generation script: `node scripts/generate-blog-posts.js ${MILESTONE_VERSION} "${MILESTONE_NAME}"`
3. Handle errors gracefully:
   - Script has built-in retry logic (3 attempts with exponential backoff)
   - If script returns error after retries, log warning but continue
   - Use `set +e` before script call, check exit code after
   - Log: "⚠ Blog generation failed after retries. Milestone completion continues."
4. If successful, log: "✓ Blog posts generated: docs/blog/v${MILESTONE_VERSION}-*.md"

**Non-blocking behavior:**
- Always continue to next step (git_commit_milestone) regardless of blog generation success/failure
- Errors are warnings, not failures
- Milestone completion proceeds normally even if blog generation fails

**Integration notes:**
- Milestone version comes from git_tag step (v[X.Y] format)
- Milestone name comes from user input in verify_readiness step
- Script path: `scripts/generate-blog-posts.js` (relative to repo root)
- Output location: `docs/blog/` (already gitignored from Plan 03-01)

Insert this step after `<step name="git_tag">` and before `<step name="git_commit_milestone">`.
</action>
  <verify>
Workflow step exists:
```bash
grep -A 20 "generate_blog_posts" get-shit-done/workflows/complete-milestone.md | head -5
```
Step is positioned after git_tag and before git_commit_milestone:
```bash
grep -B 5 -A 5 "generate_blog_posts" get-shit-done/workflows/complete-milestone.md
```
Step includes config check and error handling (non-blocking).
  </verify>
  <done>
Blog generation step added to complete-milestone workflow after git_tag, with config check, script invocation, and non-blocking error handling.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add blog_generation config flag</name>
  <files>
    .planning/config.json
  </files>
  <action>
Add `blog_generation` flag to `.planning/config.json`:

**Add to config:**
```json
{
  "mode": "yolo",
  "depth": "standard",
  "parallelization": true,
  "commit_docs": true,
  "model_profile": "balanced",
  "blog_generation": true,
  "workflow": {
    "research": true,
    "plan_check": true,
    "verifier": true
  },
  "git": {
    "branching_strategy": "phase",
    "base_branch": "main"
  }
}
```

**Default value:** `true` (blog generation enabled by default)

**Purpose:** Allow users to disable blog generation if desired (e.g., for internal milestones, or if generation is causing issues)

**Config extraction pattern:** Already established in workflow (matches pattern used for `commit_docs`):
```bash
BLOG_GENERATION=$(cat .planning/config.json 2>/dev/null | grep -o '"blog_generation"[[:space:]]*:[[:space:]]*[^,}]*' | grep -o 'true\|false' || echo "true")
```

Add flag to config file, preserving existing structure and formatting.
  </action>
  <verify>
Config flag exists:
```bash
grep -q "blog_generation" .planning/config.json && echo "✓ Config flag added"
```
Config is valid JSON:
```bash
node -e "JSON.parse(require('fs').readFileSync('.planning/config.json', 'utf8')); console.log('✓ Valid JSON')"
```
  </verify>
  <done>
blog_generation flag added to config.json with default value true. Config extraction pattern matches existing workflow patterns.
  </done>
</task>

</tasks>

<verification>
- Blog generation step exists in complete-milestone workflow
- Step positioned correctly (after git_tag, before git_commit_milestone)
- Step includes config check for blog_generation flag
- Step calls generate-blog-posts.js script with milestone version and name
- Step handles errors non-blocking (warns but continues)
- blog_generation flag added to config.json
- Config extraction pattern matches existing workflow patterns
</verification>

<success_criteria>
- Blog generation automatically triggers when /gsd:complete-milestone runs
- Blog generation can be disabled via config.json
- Blog generation failures don't block milestone completion
- Workflow integration complete and tested
</success_criteria>

<output>
After completion, create `.planning/phases/03-milestone-blog-posts/03-03-SUMMARY.md`
</output>
